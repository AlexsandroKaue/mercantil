<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{principal}">
<head>
  <title th:text="#{mercadinho}"></title>
</head>

  <section layout:fragment="container">
    <form role="form"  method="POST" th:action="@{/caixa}" th:object="${caixa}">
      <header layout:insert="~{cabecalho}"></header>
      <header layout:insert="~{corpo}"></header>
    </form>
    
    <div class="modal" id="modalIncluirProduto">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title"></h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <label for="inputCodigoProduto" class="col-form-label">Produto</label>
                  <input id="inputCodigoProduto" type="text" class="form-control">
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
            <a th:href="@{/caixa/incluir/}" class="js-incluir btn btn-md btn-success" th:text="#{incluir}"></a>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal --> 
    
    <div class="modal" id="modalExcluirProduto">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title"></h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <label for="inputCodigoProduto" class="col-form-label">Produto</label>
                  <input id="inputCodigoProduto" type="text" class="form-control">
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
            <a th:href="@{/caixa/excluir/}" class="js-excluir btn btn-md btn-success" th:text="#{excluir}"></a>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal --> 
  </section>
  
  <section layout:fragment="cabecalho">
    <div class="col-md-12">
      <div class="bg-white py-2 px-3 my-0 rounded" style="border-style: solid; border-width: 2px; border-color: #cbd3da;">
        <h1 class="text-center" style="color: #708599;">
          Pronto para registrar
        </h1>
      </div>
    </div>
  </section>
  
  <section layout:fragment="conteudo">
    <div class="card card-default">
      <!-- <div class="card-header"></div> -->
      <div class="card-body">
        <div class="row" >
          
          <div class="col-md-3">
            <div class="progress-group">
              <h6>Código</h6>
              <div class="input-group">
              <input type="text" class="form-control" disabled="disabled"></input>
              <div class="input-group-append">
                <a data-toggle="modal" data-target="#modalIncluirProduto"
                 class="btn btn-block bg-gradient-success">
                  <i class="fas fa-plus"></i>
                </a>
              </div>
            </div>  
            </div>
            <!-- /.progress-group -->
            
            <div class="progress-group">
              <h6>Quantidade</h6>
              <input type="text"  class="form-control" disabled="disabled"></input>
            </div>
            <!-- /.progress-group -->
            
            <div class="progress-group">
              <h6>Preço Unitário</h6>
              <input type="text"  class="form-control" disabled="disabled"></input>
            </div>
            <!-- /.progress-group -->
            
            <div class="progress-group">
              <h6>Preço Total</h6>
              <input type="text" class="form-control" disabled="disabled"></input>
            </div>
            <!-- /.progress-group -->
            
            <div class="progress-group text-right">
              <h1 class="mt-3"><span class="text">Subtotal</span></h1>
              <div class="bg-gray py-2 px-3 ">
                <h1 class="mb-0" style="font-family: 'Nimbus Sans Narrow', Times, monospace;">
                  R$ 80,00
                </h1>
              </div>
           </div>
           <!-- /.progress-group -->
          </div>
          <!-- /.col -->
                 
          <div class="col-md-7">
            <div style="border-style: solid; border-width: 2px; border-color: #cbd3da">
            
              <!-- <div class="box-profile">
                <div id="cupom"><pre th:text="${cupom}" style="height: 400px"></pre></div>
              </div> -->
              <div class="chart">
                <ul id="listaDeItens" data-widget="todo-list" class="items-list" style="height: 401px">
                 
                </ul>
              </div>
            </div>
          </div>
          
          <div class="col-md-2">
           <div class=" text-right">
              <div class="btn btn-primary btn-lg btn-flat py-3 btn-block">
                <!-- <i class="fas fa-cart-plus fa-lg mr-2"></i> -->
                <i class="fas fa-cart-plus fa-lg mr-2"></i> 
                Pagamento
              </div>
            </div>
            
            <div class=" text-right">
              <div class="btn btn-danger btn-lg btn-flat btn-block py-3 mt-2">
                <!-- <i class="fas fa-cart-plus fa-lg mr-2"></i> -->
                <i class="fas fa-cart-plus fa-lg mr-2"></i> 
                Cancelar
              </div>
            </div>
            
            <div class=" text-right">
              <div class="btn btn-warning btn-lg btn-flat btn-block py-3 mt-2">
                <a data-toggle="modal" data-target="#modalExcluirProduto">
                  <i class="fas fa-cart-minus fa-lg mr-2"></i> 
                  <i class="fas fa-minus-circle fa-lg mr-2"></i>
                  Remover
                </a>
              </div>
            </div>
            

          </div>
          
          </div>
        </div>
        <!-- /.row -->
        <!-- <div class="card-footer"></div> -->
      
    </div>
    <!-- /.card -->
  </section>
  
  <script layout:fragment="js-validator">
  	$('.js-incluir').on('click', function(event) {
		event.preventDefault();
		
		var botaoIncluir = $(event.currentTarget);
		var urlIncluirItem = botaoIncluir.attr('href');
		var codigoProduto = $('#modalIncluirProduto').find('input#inputCodigoProduto').val();
		urlIncluirItem += codigoProduto;
		console.log(urlIncluirItem);
		
		var response = $.ajax({
			url: urlIncluirItem,
			type: 'GET'
		})
		
		response.done(function(e){
			var check = ''+
  			'<div  class="icheck-primary d-inline ml-2">'+
      			'<input type="checkbox" value="" name="todo4" id="todoCheck4"></input>'+
      			'<label for="todoCheck4"></label>'+
  			'</div>';
			
			var li = '';
			for(var i=0; i<e.length; i++) {
				li += '<li class="item" id="item'+(i+1)+'""> '+
    				'<div class="row align-items-end">'+
        				'<div class="col-md-4">'+
            				'<h5><b id="descricao">'+ e[i].produto.descricao +'</b></h5>'+
            				'<h6 id="codigo">'+ e[i].produto.codigo +'</h6>'+
        				'</div>'+
        				'<div class="col-md-3 text-center">'+
          					'<h5 id="quantidade">3un x 1,20</h5>'+
          				'</div>'+
          				'<div class="col-md-4 text-right">'+
          					'<h5>R$ 3,60</h5>'+
        				'</div>'+
    				'</div>'+
				'</li>'+
				'<li class="linha border-bottom"></li>';
			}
			$('#listaDeItens').html(li);
			
			
		});
		
		response.fail(function(e){
			console.log(e);
			alert('Erro incluindo item');
		});
		
		$('#modalIncluirProduto').modal("hide");
		
	});
  	
  	$('#item1').on('click', function(event) {
  		console.log(event);
  	});
  	
  	$('.js-excluir').on('click', function(event) {
		event.preventDefault();
		
		var botaoExcluir = $(event.currentTarget);
		var urlExcluirItem = botaoExcluir.attr('href');
		var codigoProduto = $('#modalExcluirProduto').find('input#inputCodigoProduto').val();
		urlExcluirItem += codigoProduto;
		
		var response = $.ajax({
			url: urlExcluirItem,
			type: 'GET'
		});
		
		response.done(function(e){
			var check = ''+
  			'<div  class="icheck-primary d-inline ml-2">'+
      			'<input type="checkbox" value="" name="todo4" id="todoCheck4"></input>'+
      			'<label for="todoCheck4"></label>'+
  			'</div>';
			
			var li = '';
			for(var i=0; i<e.length; i++) {
				li += '<li class="item"> '+
    				'<div class="row align-items-end">'+
        				'<div class="col-md-4">'+
            				'<h5><b id="descricao">'+ e[i].produto.descricao +'</b></h5>'+
            				'<h6 id="codigo">'+ e[i].produto.codigo +'</h6>'+
        				'</div>'+
        				'<div class="col-md-3 text-center">'+
          					'<h5 id="quantidade">3un x 1,20</h5>'+
          				'</div>'+
          				'<div class="col-md-4 text-right">'+
          					'<h5>R$ 3,60</h5>'+
        				'</div>'+
    				'</div>'+
				'</li>'+
				'<li class="linha border-bottom"></li>';
			}
			$('#listaDeItens').html(li);
			
			
		});
		
		response.fail(function(e){
			console.log(e);
			alert('Erro excluindo item');
		});
		
		$('#modalExcluirProduto').modal("hide");
		
	});
  </script>
    
</html>
