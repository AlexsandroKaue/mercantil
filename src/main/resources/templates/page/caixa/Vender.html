<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{principal}">
<head>
  <title th:text="#{mercadinho}"></title>
</head>

  <section layout:fragment="container">
    <form role="form"  method="POST" th:action="@{/caixa/finalizarVenda}" th:object="${venda}">
      <!-- <header layout:insert="~{cabecalho}"></header> -->
      <div class="pt-2"></div>
      <header layout:insert="~{corpo}"></header>
      
      <div class="modal" id="modalPagamento">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Pagamento</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            
            <div class="modal-body">
              <div class="row">
                <div class="col-12">
                  
                  <div class="table-responsive">
                    <table class="table">
                      <tr>
                        <th class="lead mt-2" style="width:50%">Subtotal:</th>
                        <td id="subtotal"><h3 class="mb-0">R$ 0,00</h3></td>
                      </tr>
                      <tr>
                        <th class="lead">Desconto (0%):</th>
                        <td><p class="mb-0">R$ 0,00</p></td>
                      </tr>
                      <tr>
                        <th class="lead">Total:</th>
                        <td><h3 class="mb-0">R$ 0,00</h3></td>
                      </tr>
                      <tr>
                        <th class="lead">Saldo:</th>
                        <td>
                          <div class="input-group input-group-lg">
                            <input type="text" class="form-control" id="inputSaldo"></input>
                          </div>
                        </td>
                      </tr>
                      
                    </table>
                  </div>
                  
                </div>
              </div>
              <!-- /.row -->
            </div>
            
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Voltar</button>
              <button type="submit" class="btn btn-md btn-success">
                <i class="far fa-credit-card"></i> 
                Finalizar
              </button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal --> 
      
      <div class="modal" id="modalExcluirProduto">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"></h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            
            <div class="modal-body">
              <div class="row">
                <div class="col-md-12">
                  <table id="tabelaDeItens" class="table table-bordered table-striped js-tabela">
                    <thead>
                      <tr>
                        <th class="text-center col-3" th:text="#{codigo}"></th>
                        <th th:text="#{descricao}" ></th>
                        <th class="text-center col-2" th:text="#{quantidade}"></th>
                        <th class="text-center col-1"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="item : ${venda.itemList}">
                        <td colspan="4">Nenhum produto foi encontrado.</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
              <a th:href="@{/caixa/excluir/}" class="js-excluir btn btn-md btn-success" th:text="#{excluir}"></a>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal --> 
    </form>
    
    <div class="modal" id="modalIncluirProduto">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title"></h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <div class="input-group">
                  <input class="form-control" id="inputCodigoProduto" type="text"
                    placeholder="Qual produto você está procurando?" autofocus="autofocus"></input>
                  <div class="input-group-append">
                    <a th:href="@{/caixa/buscarProduto/}" class="js-buscar-produto btn btn-md btn-default">
                      <i class="fas fa-search"></i>
                    </a>
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <table id="tabelaDeProdutos" class="table table-bordered table-striped js-tabela">
                  <thead>
                    <tr>
                      <th class="text-center col-1" th:text="#{codigo}"></th>
                      <th th:text="#{descricao}" ></th>
                      <th class="text-center col-2" th:text="#{categoria}"></th>
                      <th class="text-center col-2"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="produto : ${listaDeProdutos}">
                      <td colspan="4">Nenhum produto foi encontrado.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
            <a th:href="@{/caixa/incluir/}" class="js-incluir btn btn-md btn-success" th:text="#{incluir}"></a>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal --> 
    
    <div class="modal" id="modalEscolherCliente">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">
              Clientes
            </h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <div class="modal-body">
            <div class="row d-flex align-items-stretch">
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>Marcos Novaes</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user1-128x128.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Endereço: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Telefone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>José Alves</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user2-160x160.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Address: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Phone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>Fernanda Araújo</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user4-128x128.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Endereço: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Telefone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>Marcos Novaes</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user1-128x128.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Endereço: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Telefone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>José Alves</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user2-160x160.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Address: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Phone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch">
                <div class="card bg-light">
                  <div class="card-header text-muted border-bottom-0"></div>
                  <div class="card-body pt-0">
                    <div class="row">
                      <div class="col-7">
                        <h2 class="lead"><b>Fernanda Araújo</b></h2>
                      </div>
                      <div class="col-5 text-center">
                        <img th:src="@{/dist/img/user4-128x128.jpg}" alt="" class="img-circle img-fluid"></img>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-12">
                        <!-- <p class="text-muted text-sm"><b>Sobre: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p> -->
                        <ul class="ml-4 mb-0 fa-ul text-muted">
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Endereço: Demo Street 123, Demo City 04312, NJ</li>
                          <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Telefone #: + 800 - 12 12 23 52</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="text-right">
                      <a href="#" class="btn btn-sm bg-teal">
                        <i class="fas fa-comments"></i>
                      </a>
                      <a href="#" class="btn btn-sm btn-primary">
                        <i class="fas fa-user"></i> Selecionar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
          
          <div class="card-footer">
            <nav aria-label="Contacts Page Navigation">
              <ul class="pagination justify-content-center m-0">
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">4</a></li>
                <li class="page-item"><a class="page-link" href="#">5</a></li>
                <li class="page-item"><a class="page-link" href="#">6</a></li>
                <li class="page-item"><a class="page-link" href="#">7</a></li>
                <li class="page-item"><a class="page-link" href="#">8</a></li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
  
  </section>
  
  <section layout:fragment="conteudo">
    <div class="row">
    <div class="col-md-12">
    <div class="card card-default">
      <!-- <div class="card-header"></div> -->
      <div class="card-body">
        <div class="row mb-2 align-items-center">
          <div class="col-md-8">
            <div class="bg-white rounded" style="border-style: solid; border-width: 2px; border-color: #cbd3da;">
              <h2 id="descricaoProduto" class="text-center text-success">
                <strong>Produto</strong>
              </h2>
            </div>
          </div>
          <div class="col-md-4 text-center">
            <!-- <div class="bg-white rounded py-1" style="border-style: solid; border-width: 2px; border-color: #cbd3da;"> -->
              <div class="btn btn-flat">
                Status:
                <i class="fas fa-circle text-yellow"></i>
                Registrando
              </div>
            <!-- </div> -->
          </div>
        </div>
      
        <div class="row" >
                 
          <div class="col-md-8">
            <div class="bg-white py-2 px-2" style="border-style: solid; border-width: 2px; border-color: #cbd3da;">
              <ul class="items-list" style="height: 25px; margin-bottom: 0px">
                <li>
                  <div class="row">
                    <div class="col-md-4 text-left">
                      <h5 class="lead mb-0">
                        Descrição
                      </h5>
                    </div>
                    <div class="col-md-4 text-center">
                      <h5 class="lead mb-0">
                        Quantidade x Preço Unitário
                      </h5>
                    </div>
                    <div class="col-md-4 text-right">
                      <h5 class="lead mb-0">
                        Preço Total
                      </h5>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            
            <div style="border-style: none solid solid solid; border-width: 2px;border-color: #cbd3da; background-color: #fffed4">
              <div class="chart">
                <ul id="listaDeItens" data-widget="todo-list" class="items-list" style="height: 330px">
                  <li th:each="item : ${venda.itemList}"></li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="col-md-4">
            <div class=" text-center">
              <div class="btn btn-info btn-flat btn-block py-2">
                <a data-toggle="modal" data-target="#modalEscolherCliente">
                  <i class="fas fa-user fa-lg mr-2"></i>
                  Selecionar usuário
                </a>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-md-6">
                <div class=" text-center">
                  <!-- <div class="btn btn-success btn-flat btn-block py-2"> -->
                    <a class="btn btn-success btn-flat btn-block py-2"
                       th:href="@{#}" data-toggle="modal" data-target="#modalIncluirProduto">
                      <i class="fas fa-plus mr-2"></i>
                      Incluir
                    </a>
                  <!-- </div> -->
                </div>
              </div>
              <div class="col-md-6">
                <div class=" text-right">
                  <!-- <div class="btn btn-primary btn-flat py-2 btn-block"> -->
                    <a th:href="@{#}" class="btn btn-primary btn-flat py-2 btn-block" 
                      data-toggle="modal" data-target="#modalPagamento">
                      <!-- <i class="fas fa-cart-plus fa-lg mr-2"></i> -->
                      <i class="fas fa-cart-plus mr-2"></i> 
                      Pagamento
                    </a>
                  <!-- </div> -->
                </div>
              </div>
              </div>
              <div class="row mt-2">
              <div class="col-md-6">
                <div class=" text-right">
                  <!-- <div class="btn btn-warning btn-flat btn-block py-2"> -->
                    <a class="js-buscar-itens btn btn-warning btn-flat btn-block py-2" 
                      th:href="@{/caixa/obterItens}">
                      <i class="fas fa-minus-circle mr-2"></i>
                      Remover
                    </a>
                  <!-- </div> -->
                </div>
              </div>
              <div class="col-md-6">
                <div class=" text-right">
                  <div class="btn btn-danger btn-flat btn-block py-2">
                    <!-- <i class="fas fa-cart-plus fa-lg mr-2"></i> -->
                    <i class="fas fa-cart-arrow-down mr-2"></i> 
                    Cancelar
                  </div>
                </div>
              </div>
              </div>
            
            
            <div class="progress-group text-right">
              <h2><span class="text">Subtotal</span></h2>
              <div class="bg-gray py-2 px-3 ">
                <h2 id="subtotal" class="mb-0" style="font-family: 'Nimbus Sans Narrow', Times, monospace;">
                  R$ 0,00
                </h2>
              </div>
           </div>
           <!-- /.progress-group -->
          </div>
          
          </div>
        </div>
        <!-- /.row -->
        <div class="card-footer py-0">
          <div class="row">
            <div class="col-sm-3 col-6">
              <div class="description-block border-right">
                <!-- <span class="description-percentage text-success"><i class="fas fa-caret-up"></i> 17%</span> -->
                <h5 class="description-header">Cliente</h5>
                <span class="description-text">Fernanda Araújo</span>
              </div>
              <!-- /.description-block -->
            </div>
            <!-- /.col -->
            <div class="col-sm-3 col-6">
              <div class="description-block border-right">
                <span class="description-percentage text-warning"><i class="fas fa-caret-left"></i> 0%</span>
                <h5 class="description-header">$10,390.90</h5>
              </div>
              <!-- /.description-block -->
            </div>
            <!-- /.col -->
            <div class="col-sm-3 col-6">
              <div class="description-block border-right">
                <span class="description-percentage text-success"><i class="fas fa-caret-up"></i> 20%</span>
                <h5 class="description-header">$24,813.53</h5>
              </div>
              <!-- /.description-block -->
            </div>
            <!-- /.col -->
            <div class="col-sm-3 col-6">
              <div class="description-block">
                <span class="description-percentage text-danger"><i class="fas fa-caret-down"></i> 18%</span>
                <h5 class="description-header">1200</h5>
              </div>
              <!-- /.description-block -->
            </div>
          </div>
          <!-- /.row -->
        </div>
      
    </div>
    <!-- /.card -->
    </div>
    </div>
  </section>
  
  <script layout:fragment="js-validator">

  	$('.js-incluir').on('click', function(event) {
		event.preventDefault();
		
		var botaoIncluir = $(event.currentTarget);
		//var codigoProduto = $('#modalIncluirProduto').find('input#inputCodigoProduto').val();

		var rows = $('#modalIncluirProduto').find('#tabelaDeProdutos tbody tr');
		rows.each(function(index, element) {
			var isChecked = $(element).find('td input[name="todo1"]').is(':checked');
			if(isChecked) {
				var urlIncluirItem = botaoIncluir.attr('href');
				var codigo = $(element).find('td input[name="todo1"]').attr('id');
				urlIncluirItem += codigo;
				console.log(urlIncluirItem);
				var response = $.ajax({
					url: urlIncluirItem,
					type: 'GET'
				});
				
				response.done(function(e){
					atualizarLista(e.venda, e.item);
				});
				
				response.fail(function(e){
					alert('Erro incluindo item');
				});
			}
		});
		
		$('#modalIncluirProduto').modal("hide");
		
	});
  	
  	$('.js-excluir').on('click', function(event) {
		event.preventDefault();
		
		var botaoExcluir = $(event.currentTarget);
					
		var rows = $('#modalExcluirProduto').find('#tabelaDeItens tbody tr');
		rows.each(function(index, element) {
			var isChecked = $(element).find('td input[name="todo1"]').is(':checked');
			if(isChecked) {
				var urlExcluirItem = botaoExcluir.attr('href');
				var codigo = $(element).find('td input[name="todo1"]').attr('id');
				urlExcluirItem += codigo;
				console.log(urlExcluirItem);
				var response = $.ajax({
					url: urlExcluirItem,
					type: 'GET'
				});
				
				response.done(function(e){
					atualizarLista(e.venda, e.item);
				});
				
				response.fail(function(e){
					alert('Erro excluindo item');
				});
			}
		});
		
		$('#modalExcluirProduto').modal("hide");
		
	});
  	
 	// Execute a function when the user releases a key on the keyboard
  	$('#inputCodigoProduto').on('keyup', function(event) {
  	  // Number 13 is the "Enter" key on the keyboard
  	  if (event.keyCode === 13) {
  	    // Cancel the default action, if needed
  	    event.preventDefault();
  	    // Trigger the button element with a click
  	    $('.js-buscar-produto').click();
  	  }
  	}); 
  	
  	$('.js-buscar-produto').on('click', function(event) {
		event.preventDefault();
		
		var botaoPesquisarProduto = $(event.currentTarget);
		var urlPesquisarProduto = botaoPesquisarProduto.attr('href');
		var termoDaPesquisa = $('#modalIncluirProduto').find('input#inputCodigoProduto').val();
		urlPesquisarProduto += termoDaPesquisa;
		
		console.log(urlPesquisarProduto);
					
		var response = $.ajax({
			url: urlPesquisarProduto,
			type: 'GET'
		});
		
		response.done(function(listaDeProdutos){
			console.log(listaDeProdutos);
  			var tr = '';
  			var produto;
  			
  			$('#tabelaDeProdutos').DataTable().clear();


  			if(listaDeProdutos.length < 1) {
  				tr += '<tr>'+
    					'<td colspan="4">Nenhum produto foi encontrado.</td>'+
    				'</tr>';
  			} else {
  				for(var i=0; i<listaDeProdutos.length; i++) {
  	  				produto = listaDeProdutos[i];
  	  				
  	  				tr += 
  	  				'<tr>'+
  	    				'<td class="text-center">'+ produto.codigo +'</td>'+
  	    				'<td>' + produto.descricao + '</td>'+
  	                    '<td class="text-center">'+ produto.categoria.descricao +'</td>'+
  	                    '<td class="text-center">'+
  	                        '<a class="btn btn-link btn-sm">'+
  	                          '<i class="fas fa-times"></i>'+
  	                        '</a>'+
  	                    '</td>'+
  	                '</tr>'; 
  	                
  	              $('#tabelaDeProdutos').DataTable().row.add([
  	            	  produto.codigo, 
  	            	  produto.descricao,
  	            	  produto.categoria.descricao,
  	            	  '<div class="d-flex flex-row bd-highlight">'+
    	            	  '<div class="icheck-primary d-inline ml-2">'+
    	            	  	'<input type="checkbox" value="" name="todo1" id="'+produto.codigo+'">'+
    	            	  	'<label for="'+produto.codigo+'"></label>'+
    	            	  '</div>'+
    	            	  '<input disabled="disabled" type="number" id="quantity" name="quantity" min="1" max="5">'+
  	            	  '</div>']);
  	  			}
  			}
  			
  			$('#tabelaDeProdutos').DataTable().draw();
  			
		});
		
		response.fail(function(e){
			alert('Erro buscando produto');
		});
  	});
  	
  	$('.js-buscar-itens').on('click', function(event) {
		event.preventDefault();
		
		var botaoBuscatItens = $(event.currentTarget);
		var urlBuscarItens = botaoBuscatItens.attr('href');
					
		var response = $.ajax({
			url: urlBuscarItens,
			type: 'GET'
		});
		
		response.done(function(listaDeItens){
  			var item;
  			
  			$('#tabelaDeItens').DataTable().clear();

  			if(listaDeItens.length > 0) {
  				for(var i=0; i<listaDeItens.length; i++) {
  	  				item = listaDeItens[i];
  	  				console.log(item);
  	                
  	              $('#tabelaDeItens').DataTable().row.add([
  	            	  item.produto.codigo, 
  	            	  item.produto.descricao,
  	            	  item.quantidade,
  	            	  '<div class="d-flex flex-row bd-highlight">'+
    	            	  '<div class="icheck-danger d-inline ml-2">'+
    	            	  	'<input type="checkbox" value="" name="todo1" id="'+item.produto.codigo+'">'+
    	            	  	'<label for="'+item.produto.codigo+'"></label>'+
    	            	  '</div>'+
  	            	  '</div>']);
  	  			}
  			} 
  			
  			$('#tabelaDeItens').DataTable().draw();
  			$('#modalExcluirProduto').modal('show');
  			
		});
		
		response.fail(function(e){
			alert('Erro buscando itens');
		});
  	});
  	
  	$('#modalIncluirProduto').on('hidden.bs.modal', function (event){
  		$('#modalIncluirProduto').find('input#inputCodigoProduto').val(null);
  		var tabelaProdutos = $('#tabelaDeProdutos').DataTable();
  		tabelaProdutos.clear();
  		tabelaProdutos.draw();
  	});
  	
  	$('#modalIncluirProduto').on('shown.bs.modal', function (event){
  		$('#modalIncluirProduto').find('input#inputCodigoProduto').focus();
  	});
  	
  	$('#modalPagamento').on('shown.bs.modal', function(event) {
  		$(this).find('input#inputSaldo').focus();
  	});
  	
  	function atualizarLista(venda, item) {
  		var listaDeItem = venda.itemList;
		// Create our number formatters.
		var currencyformatter = new Intl.NumberFormat('pt-BR', {
		  style: "currency",
		  currency: "BRL",
		  minimumFractionDigits: 2,
		  currencyDisplay: "symbol",
		});
		
		var decimalformatter = new Intl.NumberFormat('pt-BR', {
		  minimumFractionDigits: 2
		});
		
		//var subtotal = 0.0;
		var li = '';
		for(var i=0; i<listaDeItem.length; i++) {
			li += '<li class="item"> '+
				'<div class="row align-items-end">'+
    				'<div class="col-md-4 text-left">'+
        				'<h6><b id="descricao">'+ listaDeItem[i].produto.descricao +'</b></h6>'+
        				'<h6 id="codigo">'+ listaDeItem[i].produto.codigo +'</h6>'+
    				'</div>'+
    				'<div class="col-md-4 text-center">'+
      					'<h6 id="quantidade">'+listaDeItem[i].quantidade+'un x '+ decimalformatter.format(listaDeItem[i].valor)+'</h6>'+
      				'</div>'+
      				'<div class="col-md-4 text-right">'+
      					'<h5>'+currencyformatter.format(listaDeItem[i].quantidade*listaDeItem[i].valor)+'</h5>'+
    				'</div>'+
				'</div>'+
			'</li>'+
			'<li class="linha border-bottom"></li>';
			//subtotal += listaDeItem[i].valor*listaDeItem[i].quantidade;
		}
		$('#descricaoProduto').html('<strong>'+item.produto.descricao+'</strong>');//item.quantidade +' X '
		$('#listaDeItens').html(li);
		$('#subtotal').html('<h3>'+currencyformatter.format(venda.subtotal)+'</h3>');
	}
  </script>
    
</html>
